((function(){var a,b,c,d,e;a=0,b=["ms","moz","webkit","o"],d=function(a){return window.requestAnimationFrame=window[b[a]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[a]+"CancelAnimationFrame"]||window[b[a]+"CancelRequestAnimationFrame"]};for(c=0,e=b.length;0<=e?c<=e:c>=e;0<=e?c++:c--)d.call(this,c);window.requestAnimationFrame||(window.requestAnimationFrame=function(b,c){var d,e,f;return d=(new Date).getTime(),f=Math.max(0,16-(d-a)),e=window.setTimeout(function(){return b(d+f)},f),a=d+f,e});if(!window.cancelAnimationFrame)return window.cancelAnimationFrame=function(a){return window.clearTimeout(a)}})).call(this),CanvasRenderingContext2D.prototype.roundRect=function(a,b,c,d,e){return c<2*e&&(e=c/2),d<2*e&&(e=d/2),this.beginPath(),this.moveTo(a+e,b),this.arcTo(a+c,b,a+c,b+d,e),this.arcTo(a+c,b+d,a,b+d,e),this.arcTo(a,b+d,a,b,e),this.arcTo(a,b,a+c,b,e),this.closePath(),this},window.addEventListener||(window.addEventListener=function(a,b,c){return window.attachEvent?window.attachEvent("on"+a,b):window["on"+a]=b}),window.addEventListener("load",function(){return setTimeout(function(){return window.scrollTo(0,1)},0)}),window.module||(window.module=!1);var Constants;Constants={SCALE:.1,SCALE_INV:10,BOTTOM:60,BASE_WIDTH:480,BASE_HEIGHT:268,JUMP_ACCEL:-38,MOVE_ACCEL:25,POLE_WIDTH:8,POLE_HEIGHT:64,GRAVITY:.15,ARROW_WIDTH:121,SET_DELAY:800,WIN_SCORE:6,POINT_WIDTH:20,SCOREBOARD_PADDING:20,BACK_BTN_WIDTH:108,BACK_BTN_HEIGHT:26,BALL_START_HEIGHT:260,SLIME_RADIUS:32,SLIME_MASS:3.5,SLIME_JUMP:10,BALL_RADIUS:10,BALL_MASS:1.4,MOVEMENT_SPEED:4,JUMP_SPEED:12,SLIME_START_HEIGHT:91,AI_DIFFICULTY:.25,MSG_FONT:"Courier, monospace, sans-serif",TICK_DURATION:16,FRAME_DELAY:5,ASSETS:{p1:"assets/images/s_0.png",p2:"assets/images/s_1.png",bg:"assets/images/bg.png",ball:"assets/images/ball.png",eye:"assets/images/eye.png",menu_bg:"assets/images/menu_bg.png",logo:"assets/images/logo.png",btn_instructions:"assets/images/btn_instructions.png",btn_one:"assets/images/btn_one.png",btn_options:"assets/images/btn_options.png",btn_wifi:"assets/images/btn_wifi.png",btn_a:"assets/images/btn_a.png",btn_b:"assets/images/btn_b.png",pole:"assets/images/pole.png",blank_point:"assets/images/blank_point.png","return":"assets/images/return.png",score_a:"assets/images/score_a.png",score_b:"assets/images/score_b.png",instructions:"assets/images/instructions.png",back_arrow:"assets/images/back_arrow.png",options:"assets/images/options.png"}},module&&(module.exports=Constants);var Helpers;Helpers={round:function(a){return.5+a<<0},inRect:function(a,b,c,d,e,f){return a>c&&a<c+e&&b>d&&b<d+f},deg2Rad:function(a){return a*Math.PI/180},rad2Deg:function(a){return a*180/Math.PI},yFromAngle:function(a){return-Math.cos(Helpers.deg2Rad(a))},xFromAngle:function(a){return Math.sin(Helpers.deg2Rad(a))},rand:function(a){return Math.floor(Math.random()*(a+1))},dist:function(a,b){return Math.sqrt(Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2))},mag:function(a){return Math.sqrt(Math.pow(a.x,2)+Math.pow(a.y,2))}},module&&(module.exports=Helpers);var SceneManager;SceneManager=function(){function a(a){this.canvas=a,this.sceneStack=[],this.currScene=null}return a.prototype.pushScene=function(a){return this.sceneStack.push(a),this.currScene&&(this.currScene.stop(),this.currScene.ctx=null),this.currScene=a,this.currScene.ctx=this.ctx,this.currScene.initialized?this.currScene.start():this.currScene.init()},a.prototype.popScene=function(){var a;return this.currScene&&(this.currScene.stop(),this.currScene.ctx=null),a=this.sceneStack.pop(),a&&a.destroy&&a.destroy(),this.currScene=this.sceneStack[this.sceneStack.length-1]||null,this.currScene&&(this.currScene.ctx=this.ctx,this.currScene.start()),a},a}();var Scene,__hasProp=Object.prototype.hasOwnProperty;Scene=function(){function a(){var a=this;this.stopped=!0,this.initialized=!1,this.lastTimeout=0,this.width=Globals.Manager.canvas.width,this.height=Globals.Manager.canvas.height,this.center={x:this.width/2,y:this.height/2},this.canvas=Globals.Manager.canvas,this.ctx=this.canvas.getContext("2d"),this.buttons||(this.buttons={}),this.stepCallback=function(b){return a.step(b)}}return a.prototype.init=function(){return this.stopped=!1,this.initialized=!0,this.step((new Date).getTime())},a.prototype.start=function(){return this.stopped=!1,this.step((new Date).getTime())},a.prototype.step=function(a){},a.prototype.next=function(){if(!this.stopped)return this.lastTimeout=window.requestAnimationFrame(this.stepCallback)},a.prototype.stop=function(){return this.stopped=!0,window.cancelAnimationFrame(this.lastTimeout)},a.prototype.click=function(a){var b,c,d,e;d=this.buttons,e=[];for(c in d){if(!__hasProp.call(d,c))continue;b=d[c],e.push(b.handleClick(a))}return e},a.prototype.mousedown=function(a){var b,c,d,e;d=this.buttons,e=[];for(c in d){if(!__hasProp.call(d,c))continue;b=d[c],e.push(b.handleMouseDown(a))}return e},a.prototype.mousemove=function(a){var b,c,d,e;d=this.buttons,e=[];for(c in d){if(!__hasProp.call(d,c))continue;b=d[c],e.push(b.handleMouseMove(a))}return e},a.prototype.mouseup=function(a){var b,c,d,e;d=this.buttons,e=[];for(c in d){if(!__hasProp.call(d,c))continue;b=d[c],e.push(b.handleMouseUp(a))}return e},a.prototype.mouseout=function(a){},a.prototype.buttonPressed=function(){},a}();var Loader;Loader=function(){function a(){this.progress=0,this.assets={},this.totalAssets=0,this.loadedAssets=0}return a.prototype.updateProgress=function(){this.progress=this.loadedAssets/this.totalAssets,this.onprogress&&this.onprogress(this.progress);if(this.progress===1&&this.onload)return this.onload()},a.prototype.load=function(a){var b,c,d;d=[];for(c in a)b=a[c],d.push(this.loadAsset(c,b));return d},a.prototype.loadAsset=function(a,b){var c,d;return c=new Image,d=this,c.onload=function(){return this.loaded=!0,d.loadedAssets++,d.updateProgress()},this.assets[a]={loader:this,src:b,image:c},this.totalAssets++,c.src=b},a.prototype.loadProgress=function(a){return this.onprogress=a},a.prototype.loadComplete=function(a){return this.onload=a},a.prototype.getAsset=function(a){return this.assets[a].image},a}();var Input;Input=function(){function a(){var a,b,c,d,e,f,g,h,i,j,k,l,m=this;this.keys={},this.anyInput=!1,k=function(a){return a.which||(a.which=a.charCode),a.which||(a.which=a.keyCode),a},j=function(a){var b,c;return c=Globals.Manager.canvas,b=c.getBoundingClientRect(),a.x=(a.x-b.left)*(c.width/b.width),a.y=(a.y-b.top)*(c.height/b.height),a},l=function(a){var b,c,d;return b=Globals.Manager.canvas,c=a.clientX||a.x||a.layerX,d=a.clientY||a.y||a.layerY,j({x:c,y:d,identifier:a.identifier})},c=function(a){return m.anyInput=!0,m.keys["key"+k(a).which]=!0},d=function(a){return m.anyInput=!1,m.keys["key"+k(a).which]=!1},h=function(a){return m.anyInput=!1,a=l(a),Globals.Manager.currScene.mouseup(a)},e=function(a){return m.anyInput=!0,a=l(a),Globals.Manager.currScene.mousedown(a)},f=function(a){return a=l(a),Globals.Manager.currScene.mousemove(a)},b=function(a){return a=l(a),Globals.Manager.currScene.click(a)},g=function(a){return a=l(a),Globals.Manager.currScene.mouseout(a)},i=function(a){return function(a){return function(b){var c,d,e,f;b.preventDefault(),f=b.changedTouches;for(d=0,e=f.length;d<e;d++)c=f[d],a({x:c.clientX,y:c.clientY,identifier:c.identifier})}}.call(this,a)},a=Globals.Manager.canvas,document.addEventListener("keydown",c,!0),document.addEventListener("keyup",d,!0),a.addEventListener("mouseup",h,!0),a.addEventListener("mousedown",e,!0),a.addEventListener("mousemove",f,!0),a.addEventListener("mouseout",g,!0),a.addEventListener("click",b,!0),document.documentElement.addEventListener("touchstart",i(e),!0),document.documentElement.addEventListener("touchend",i(h),!0),window.addEventListener("touchmove",i(f),!0),window.addEventListener("touchcancel",i(h),!0),this.shortcuts={left:["key37","key65"],right:["key39","key68"],up:["key38","key87"],down:["key40","key83"]}}return a.prototype.left=function(a){return this.keys[this.shortcuts.left[a]]||!1},a.prototype.right=function(a){return this.keys[this.shortcuts.right[a]]||!1},a.prototype.up=function(a){return this.keys[this.shortcuts.up[a]]||!1},a.prototype.down=function(a){return this.keys[this.shortcuts.down[a]]||!1},a.prototype.reset=function(){var a,b,c,d;c=this.keys,d=[];for(a in c)b=c[a],d.push(this.keys[a]=!1);return d},a.prototype.set=function(a,b,c){return c==null&&(c=0),this.keys[this.shortcuts[a][c]]=b},a}();var Constants,Sprite;module&&(Constants=require("./constants")),Sprite=function(){function a(a,b,c,d,e){this.x=a,this.y=b,this.width=c,this.height=d,this.bg=e,this.velocity||(this.velocity={x:0,y:0}),this.acceleration||(this.acceleration={x:0,y:Constants.GRAVITY}),this.mass||(this.mass=1)}return a.prototype.setPosition=function(a,b){return b||(a.y&&(b=a.y),a.x&&(a=a.x)),this.x=a,this.y=b},a.prototype.incrementPosition=function(a){return this.x+=this.velocity.x*a,this.y+=this.velocity.y*a,this.velocity.x+=this.acceleration.x*this.mass*a*a,this.velocity.y+=this.acceleration.y*this.mass*a*a},a.prototype.draw=function(a,b,c){b||(b=this.x),c||(c=this.y);if(this.bg)return a.drawImage(this.bg,Helpers.round(b),Helpers.round(c))},a.prototype.getState=function(){return{x:this.x,y:this.y,width:this.width,height:this.height,velocity:{x:this.velocity.x,y:this.velocity.y}}},a.prototype.setState=function(a){return this.x=a.x,this.y=a.y,this.width=a.width,this.height=a.height,this.velocity={x:a.velocity.x,y:a.velocity.y}},a}(),module&&(module.exports=Sprite);var Button,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};Button=function(){function a(b,c,d,e,f,g,h){this.x=b,this.y=c,this.width=d,this.height=e,this.img=f,this.downImg=g,this.scene=h,this.down=!1,a.__super__.constructor.call(this,this.x,this.y,this.width,this.height,this.img)}return __extends(a,Sprite),a.prototype.handleMouseDown=function(a){return this.down=Helpers.inRect(a.x,a.y,this.x,this.y,this.width,this.height)},a.prototype.handleMouseUp=function(a){return this.down&&Helpers.inRect(a.x,a.y,this.x,this.y,this.width,this.height)&&this.scene&&this.scene.buttonPressed(this),this.down=!1},a.prototype.handleMouseMove=function(a){if(this.down)return this.down=Helpers.inRect(a.x,a.y,this.x,this.y,this.width,this.height)},a.prototype.handleClick=function(a){this.down=!1;if(Helpers.inRect(a.x,a.y,this.x,this.y,this.width,this.height)&&this.scene)return this.scene.buttonPressed(this)},a.prototype.draw=function(a){if(!this.img)return;return a.drawImage(this.down?this.downImg:this.img,Helpers.round(this.x),Helpers.round(this.y))},a}();var GamePad;GamePad=function(){function a(a){this.btnRects=a,this.previousPos={}}return a.prototype.inRect=function(a,b){return a?Helpers.inRect(a.x,a.y,b[0],b[1],b[2],b[3]):!1},a.prototype.findRect=function(a){var b,c,d;d=this.btnRects;for(b in d){c=d[b];if(this.inRect(a,c))return b}return null},a.prototype.savePreviousPos=function(a){return this.previousPos[(a.identifier||"0")+""]=a},a.prototype.getPreviousPos=function(a){return this.previousPos[(a.identifier||"0")+""]},a.prototype.handleMouseDown=function(a){var b;return b=this.findRect(a),b&&Globals.Input.set(b,!0),this.savePreviousPos(a)},a.prototype.handleMouseMove=function(a){var b,c,d;if(!a.identifier)return;b=this.findRect(a),d=this.getPreviousPos(a),c=d?this.findRect(d):null,this.savePreviousPos(a);if(c&&b===c)return Globals.Input.set(c,!0);if(c&&b!==c){Globals.Input.set(c,!1);if(b)return Globals.Input.set(b,!1)}},a.prototype.handleMouseUp=function(a){var b;return b=this.findRect(a),b&&Globals.Input.set(b,!1),this.savePreviousPos(a)},a.prototype.handleClick=function(){},a}();var Globals;Globals={Input:null,Manager:new SceneManager,Loader:new Loader};var StretchySprite,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};StretchySprite=function(){function a(b,c,d,e,f,g,h){this.x=b,this.y=c,this.width=d,this.height=e,this.rightCap=f,this.topCap=g,this.bg=h,this.generateStretchedImage(),a.__super__.constructor.call(this,this.x,this.y,this.width,this.height)}return __extends(a,Sprite),a.prototype.generateStretchedImage=function(){var a,b,c,d,e,f,g,h;return a=function(a,b){var c;return c=document.createElement("canvas"),c.width=a,c.height=b,c},f=a(this.width,2),c=a(8,this.height),g=f.getContext("2d"),g.drawImage(this.bg,0,this.topCap,this.bg.width,1,0,0,this.width,f.height),d=c.getContext("2d"),d.drawImage(this.bg,this.bg.width-this.rightCap-c.width,0,c.width,this.bg.height,0,this.height-this.bg.height,c.width,this.bg.height),this.stretchedImage=a(this.width,this.height),b=this.stretchedImage.getContext("2d"),b.drawImage(this.bg,this.x,this.y+this.height-this.bg.height),e=b.createPattern(c,"repeat-x"),b.fillStyle=e,b.fillRect(this.bg.width-this.rightCap,this.height-this.bg.height,this.width-this.bg.width,this.bg.height),h=b.createPattern(f,"repeat-y"),b.fillStyle=h,b.fillRect(0,this.topCap,this.width,this.height-this.bg.height),b.drawImage(this.bg,0,0,this.bg.width,this.topCap,0,0,this.width,this.topCap),b.drawImage(this.bg,this.bg.width-this.rightCap,0,this.rightCap,this.bg.height,this.width-this.rightCap,this.height-this.bg.height,this.rightCap,this.bg.height)},a.prototype.draw=function(a){return a.drawImage(this.stretchedImage,0,0)},a}();var Ball,Constants,Sprite,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};module&&(Sprite=require("./sprite"),Constants=require("./constants")),Ball=function(){function a(b,c){this.x=b,this.y=c,this.radius=Constants.BALL_RADIUS,this.falling=!0,typeof Globals!="undefined"&&(this.bg=Globals.Loader.getAsset("ball")),this.mass=Constants.BALL_MASS,a.__super__.constructor.call(this,this.x,this.y,this.radius*2,this.radius*2,this.bg)}return __extends(a,Sprite),a}(),module&&(module.exports=Ball);var Constants,Slime,Sprite,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};module&&(Sprite=require("./sprite"),Constants=require("./constants")),Slime=function(){function a(b,c,d,e){this.x=b,this.y=c,this.ball=d,this.isP2=e,this.radius=Constants.SLIME_RADIUS,this.score=0,typeof Globals!="undefined"&&(this.eyeImg=Globals.Loader.getAsset("eye"),this.bg=Globals.Loader.getAsset(this.isP2?"p2":"p1")),this.mass=Constants.SLIME_MASS,a.__super__.constructor.call(this,this.x,this.y,this.radius*2,this.radius,this.bg)}return __extends(a,Sprite),a.prototype.handleInput=function(a){var b;b=this.isP2?1:0,a.left(b)?this.velocity.x=-Constants.MOVEMENT_SPEED:a.right(b)?this.velocity.x=Constants.MOVEMENT_SPEED:this.velocity.x=0;if(a.up(b)&&this.y>=Constants.BASE_HEIGHT-Constants.BOTTOM-this.height)return this.velocity.y=-Constants.SLIME_JUMP},a.prototype.draw=function(b){var c,d,e,f,g,h;return a.__super__.draw.call(this,b),h=this.radius/2,g=h*.95,this.isP2&&(g=-g),e=[this.x+g,this.y-h],f=[g,h],c=[this.ball.x,this.ball.y],c[0]-=e[0],c[1]-=e[1],c[1]=-c[1],d=Math.sqrt(Math.pow(c[0],2)+Math.pow(c[1],2)),c[0]=c[0]/d*3+f[0],c[1]=c[1]/d*3+f[1],b.drawImage(this.eyeImg,Helpers.round(this.x+c[0]-2+this.radius),Helpers.round(this.y-c[1]-2+this.radius))},a}(),module&&(module.exports=Slime);var Scoreboard,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};Scoreboard=function(){function a(b,c,d,e){this.x=b,this.y=c,this.bgImg=d,this.slime=e,this.blankImg=Globals.Loader.getAsset("blank_point"),this.pointImg=Globals.Loader.getAsset("ball"),a.__super__.constructor.call(this,this.x,this.y,Constants.POINT_WIDTH*Constants.WIN_SCORE,Constants.POINT_WIDTH)}return __extends(a,Sprite),a.prototype.draw=function(a){var b,c,d,e,f;c=Constants.POINT_WIDTH,a.drawImage(this.bgImg,this.x,this.y);for(b=0,d=this.slime.score;0<=d?b<d:b>d;0<=d?b++:b--)a.drawImage(this.pointImg,this.x+b*c+3,this.y+2);for(b=e=this.slime.score,f=Constants.WIN_SCORE;e<=f?b<f:b>f;e<=f?b++:b--)a.drawImage(this.blankImg,this.x+b*c+3,this.y+2)},a}();var Ball,Constants,GameState,GameStateBuffer,Helpers,Slime,Sprite,World;module&&(Constants=require("./constants"),Helpers=require("./helpers"),Sprite=require("./sprite"),Slime=require("./slime"),Ball=require("./ball")),GameState=function(){function a(){}return a}(),GameStateBuffer=function(){function a(a){this.maxLength=a,this.maxLength||(this.maxLength=30),this.first=this.last=null,this.length=0}return a.prototype.push=function(a){var b;if(!this.first)return this.first=this.last=a;a.next=this.first,this.first.prev=a,this.first=a,this.length+=1,b=[];while(this.length>this.maxLength)b.push(this.pop());return b},a.prototype.pop=function(){var a;return a=this.first,this.first=this.first.next,this.first.prev=null,this.length-=1,a},a.prototype.injectPastInput=function(a,b,c){},a}(),World=function(){function a(a,b){this.width=a,this.height=b,this.lastStep=null,this.clock=0,this.numFrames=1,this.buffer=new GameStateBuffer,this.ball=new Ball(this.width/4-Constants.BALL_RADIUS,this.height-Constants.BALL_START_HEIGHT,Constants.BALL_RADIUS),this.p1=new Slime(this.width/4-Constants.SLIME_RADIUS,this.height-Constants.SLIME_START_HEIGHT,this.ball,!1),this.p2=new Slime(3*this.width/4-Constants.SLIME_RADIUS,this.height-Constants.SLIME_START_HEIGHT,this.ball,!0),this.pole=new Sprite(this.width/2-Constants.POLE_WIDTH/2,this.height-Constants.BOTTOM-Constants.POLE_HEIGHT-1,Constants.POLE_WIDTH,Constants.POLE_HEIGHT),this.deterministic=!0}return a.prototype.reset=function(a){return this.p1.setPosition(this.width/4-Constants.SLIME_RADIUS,this.height-Constants.SLIME_START_HEIGHT),this.p2.setPosition(3*this.width/4-Constants.SLIME_RADIUS,this.height-Constants.SLIME_START_HEIGHT),this.ball.setPosition((this.p2===a?3:1)*this.width/4-Constants.BALL_RADIUS,this.height-Constants.BALL_START_HEIGHT),this.pole.setPosition(this.width/2-4,this.height-60-64-1,8,64),this.p1.velocity={x:0,y:0},this.p2.velocity={x:0,y:0},this.ball.velocity={x:0,y:2},this.ball.falling=!0,this.p1.falling=this.p2.falling=!1,this.p1.jumpSpeed=this.p2.jumpSpeed=0,this.p1.gravTime=this.ball.gravTime=this.p2.gravTime=0},a.prototype.resolveCollision=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n;return m=b.velocity||{x:0,y:0},g=Helpers.mag(a.velocity)*a.mass>Helpers.mag(m)*(b.mass||1),f=a.radius+b.radius,h={x:a.x+a.radius,y:a.y+a.radius},g?i={x:a.x+a.radius+a.velocity.x,y:a.y+a.radius+a.velocity.y}:i={x:a.x+a.radius-m.x,y:a.y+a.radius-m.y},j={x:b.x+b.radius,y:b.y+b.radius},c=Math.pow(i.x-h.x,2)+Math.pow(i.y-h.y,2),d=2*((i.x-h.x)*(h.x-j.x)+(i.y-h.y)*(h.y-j.y)),e=j.x*j.x+j.y*j.y+h.x*h.x+h.y*h.y-2*(j.x*h.x+j.y*h.y)-f*f,k=(-d+Math.sqrt(d*d-4*c*e))/(2*c),l=(-d-Math.sqrt(d*d-4*c*e))/(2*c),k=Math.min(k,l),n=g?a.velocity:{x:-m.x,y:-m.y},{x:a.x+n.x*k,y:a.y+n.y*k}},a.prototype.step=function(a){var b,c,d,e,f,g,h;g=(new Date).getTime(),h=Constants.TICK_DURATION,this.lastStep&&(a||(a=g-this.lastStep)),a||(a=h),this.lastStep=g;if(a>=h*2){while(a>0)this.deterministic?f=h:f=a>=2*h?h:f,this.step(f),a-=f;return}a=h,this.numFrames=a/h,this.clock+=a,this.ball.incrementPosition(this.numFrames),this.p1.incrementPosition(this.numFrames),this.p2.incrementPosition(this.numFrames),this.boundsCheck(),this.p1.y+this.p1.height>this.height-Constants.BOTTOM&&(this.p1.y=this.height-Constants.BOTTOM-this.p1.height,this.p1.velocity.y=Math.min(this.p1.velocity.y,0)),this.p2.y+this.p2.height>this.height-Constants.BOTTOM&&(this.p2.y=this.height-Constants.BOTTOM-this.p2.height,this.p2.velocity.y=Math.min(this.p2.velocity.y,0)),this.ball.y+this.ball.height<this.p1.y+this.p1.height&&Math.sqrt(Math.pow(this.ball.x+this.ball.radius-(this.p1.x+this.p1.radius),2)+Math.pow(this.ball.y+this.ball.radius-(this.p1.y+this.p1.radius),2))<this.ball.radius+this.p1.radius&&(this.ball.setPosition(this.resolveCollision(this.ball,this.p1)),b=Helpers.rad2Deg(Math.atan(-(this.ball.x+this.ball.radius-(this.p1.x+this.p1.radius))/(this.ball.y+this.ball.radius-(this.p1.y+this.p1.radius)))),this.ball.velocity.x=Helpers.xFromAngle(b)*(6.5+1.5*Constants.AI_DIFFICULTY),this.ball.velocity.y=Helpers.yFromAngle(b)*(6.5+1.5*Constants.AI_DIFFICULTY)),this.ball.y+this.ball.height<this.p2.y+this.p2.radius&&Math.sqrt(Math.pow(this.ball.x+this.ball.radius-(this.p2.x+this.p2.radius),2)+Math.pow(this.ball.y+this.ball.radius-(this.p2.y+this.p2.radius),2))<this.ball.radius+this.p2.radius&&(this.ball.setPosition(this.resolveCollision(this.ball,this.p2)),b=Helpers.rad2Deg(Math.atan(-(this.ball.x+this.ball.radius-(this.p2.x+this.p2.radius))/(this.ball.y+this.ball.radius-(this.p2.y+this.p2.radius)))),this.ball.velocity.x=Helpers.xFromAngle(b)*(6.5+1.5*Constants.AI_DIFFICULTY),this.ball.velocity.y=Helpers.yFromAngle(b)*(6.5+1.5*Constants.AI_DIFFICULTY)),this.ball.x+this.ball.width>this.width?(this.ball.x=this.width-this.ball.width,this.ball.velocity.x*=-1,this.ball.velocity.y=Helpers.yFromAngle(180-this.ball.velocity.x/this.ball.velocity.y)*this.ball.velocity.y,Math.abs(this.ball.velocity.x)<=.1&&(this.ball.velocity.x=-1)):this.ball.x<0&&(this.ball.x=0,this.ball.velocity.x*=-1,this.ball.velocity.y=Helpers.yFromAngle(180-this.ball.velocity.x/this.ball.velocity.y)*this.ball.velocity.y,Math.abs(this.ball.velocity.x)<=.1&&(this.ball.velocity.x=1)),c=2;if(this.ball.x+this.ball.width>this.pole.x&&this.ball.x<this.pole.x+this.pole.width&&this.ball.y+this.ball.height>=this.pole.y&&this.ball.y<=this.pole.y+this.pole.height){if(this.ball.y+this.ball.radius>=this.pole.y+c)return this.ball.x=this.ball.velocity.x>0?this.pole.x-this.ball.width:this.pole.x+this.pole.width,this.ball.velocity.x*=-1,this.ball.velocity.y=Helpers.yFromAngle(180-this.ball.velocity.x/this.ball.velocity.y)*this.ball.velocity.y;if(this.ball.x+this.ball.radius<this.pole.x+c){d={x:this.pole.x+c,y:this.pole.y+c,radius:c},e=Math.sqrt(Math.pow(this.ball.x+this.ball.radius-d.x,2)+Math.pow(this.ball.y+this.ball.radius-d.y,2));if(e<d.radius+this.ball.radius)return this.ball.setPosition(this.resolveCollision(this.ball,d)),b=Helpers.rad2Deg(Math.atan(-(this.ball.x+this.ball.radius-(d.x+d.radius))/(this.ball.y+this.ball.radius-(d.y+d.radius)))),this.ball.velocity.x=Helpers.xFromAngle(b)*6,this.ball.velocity.y=Helpers.yFromAngle(b)*6}else{if(!(this.ball.x+this.ball.radius>this.pole.x+this.pole.width-c))return this.ball.velocity.y*=-1,Math.abs(this.ball.velocity.x)<.1&&(this.ball.velocity.x=.5),this.ball.y=this.pole.y-this.ball.height;d={x:this.pole.x+this.pole.width-c,y:this.pole.y+c,radius:c},e=Math.sqrt(Math.pow(this.ball.x+this.ball.radius-d.x,2)+Math.pow(this.ball.y+this.ball.radius-d.y,2));if(e<d.radius+this.ball.radius)return this.ball.setPosition(this.resolveCollision(this.ball,d)),b=Helpers.rad2Deg(Math.atan(-(this.ball.x+this.ball.radius-(d.x+d.radius))/(this.ball.y+this.ball.radius-(d.y+d.radius)))),this.ball.velocity.x=Helpers.xFromAngle(b)*6,this.ball.velocity.y=Helpers.yFromAngle(b)*6}}else if(this.ball.x<this.pole.x+this.pole.width&&this.ball.x>this.pole.x+this.ball.velocity.x&&this.ball.y>=this.pole.y&&this.ball.y<=this.pole.y+this.pole.height&&this.ball.velocity.x<0)return this.ball.y+this.ball.height>=this.pole.y+c?(this.ball.x=this.pole.x+this.pole.width,this.ball.velocity.x*=-1,this.ball.velocity.y=Helpers.yFromAngle(180-this.ball.velocity.x/this.ball.velocity.y)*this.ball.velocity.y):(this.ball.velocity.y*=-1,Math.abs(this.ball.velocity.x)<.1&&(this.ball.velocity.x=.5),this.ball.y=this.pole.y-this.ball.height)},a.prototype.boundsCheck=function(){this.p1.x<0&&(this.p1.x=0),this.p1.x+this.p1.width>this.pole.x&&(this.p1.x=this.pole.x-this.p1.width),this.p2.x<this.pole.x+this.pole.width&&(this.p2.x=this.pole.x+this.pole.width);if(this.p2.x>this.width-this.p2.width)return this.p2.x=this.width-this.p2.width},a.prototype.getState=function(){return{p1:this.p1.getState(),p2:this.p2.getState(),ball:this.ball.getState(),clock:this.clock}},a.prototype.setState=function(a){return this.p1.setState(a.p1),this.p2.setState(a.p2),this.ball.setState(a.ball)},a.prototype.injectNetworkInput=function(a,b,c){},a}(),module&&(module.exports=World);var LoadingScene,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};LoadingScene=function(){function a(){this.loadStarted=!1,this.progress=0,a.__super__.constructor.call(this)}return __extends(a,Scene),a.prototype.start=function(){var b;return b=this,this.loadStarted||(this.loadStarted=!0,Globals.Loader.loadProgress(function(a){return b.loadProgress(a,b)}),Globals.Loader.loadComplete(function(){return b.loadComplete()}),Globals.Loader.load(Constants.ASSETS)),a.__super__.start.call(this)},a.prototype.loadComplete=function(){return Globals.Manager.popScene(),Globals.Manager.pushScene(new MenuScene)},a.prototype.loadProgress=function(a,b){return this.progress=a,b.next()},a.prototype.step=function(a){if(!this.ctx)return;return this.ctx.clearRect(0,0,this.width,this.height),this.ctx.fillStyle="#444",this.ctx.fillRect(0,0,this.width,this.height),this.ctx.strokeStyle="#111",this.ctx.lineWidth=1,this.ctx.roundRect(Helpers.round(this.center.x-35),Helpers.round(this.center.y-5),70,10,2).stroke(),this.ctx.fillStyle="#444",this.ctx.roundRect(Helpers.round(this.center.x-35),Helpers.round(this.center.y-5),70,10,2).fill(),this.ctx.fillStyle="#0f0",this.ctx.roundRect(Helpers.round(this.center.x-35),Helpers.round(this.center.y-5),70*this.progress,10,2).fill(),this.ctx.font="12px Monaco, Courier New, Courier, san-serif",this.ctx.textAlign="center",this.ctx.fillStyle="#bbb",this.ctx.fillText("Loading...",Helpers.round(this.center.x),Helpers.round(this.center.y+25))},a}();var MenuScene,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};MenuScene=function(){function a(){var b,c,d,e,f,g,h,i,j,k,l;a.__super__.constructor.call(this),g=Globals.Loader,this.bg=new StretchySprite(0,0,this.width,this.height,1,1,g.getAsset("menu_bg")),this.logo=new Sprite(this.center.x-128,this.center.y-155,256,256,g.getAsset("logo")),this.logo.velocity=0,d=this.center.y+30,c=234,b=44,h=58,this.buttons={instructions:new Button((this.center.x-c)/2,d+h,c,b,g.getAsset("btn_a"),g.getAsset("btn_b"),this),onePlayer:new Button((this.center.x-c)/2,d,c,b,g.getAsset("btn_a"),g.getAsset("btn_b"),this),options:new Button(this.center.x+(this.center.x-c)/2,d+h,c,b,g.getAsset("btn_a"),g.getAsset("btn_b"),this),wifi:new Button(this.center.x+(this.center.x-c)/2,d,c,b,g.getAsset("btn_a"),g.getAsset("btn_b"),this)},this.labels=[],f=["btn_wifi","btn_options","btn_one","btn_instructions"],l=["instructions","onePlayer","options","wifi"],i=function(a){return this.labels.push(new Sprite(a.x,a.y,a.width,a.height,g.getAsset(f.pop())))};for(j=0,k=l.length;j<k;j++)e=l[j],i.call(this,this.buttons[e])}return __extends(a,Scene),a.prototype.step=function(a){var b,c,d,e,f,g,h;if(!this.ctx)return;this.next(),this.ctx.clearRect(0,0,this.width,this.height),this.bg.draw(this.ctx),this.logo.draw(this.ctx),g=this.buttons;for(c in g)b=g[c],b.draw(this.ctx);h=this.labels;for(e=0,f=h.length;e<f;e++)d=h[e],d.draw(this.ctx);return this.logo.y+=Math.sin(Math.PI/180*this.logo.velocity)/3,this.logo.velocity+=2},a.prototype.buttonPressed=function(a){if(a===this.buttons.instructions)return Globals.Manager.pushScene(new InstructionsScene);if(a===this.buttons.onePlayer)return Globals.Manager.pushScene(new SlimeVolleyball);if(a===this.buttons.options)return Globals.Manager.pushScene(new OptionsScene);if(a===this.buttons.wifi)return Globals.Manager.pushScene(new NetworkSlimeVolleyball)},a}();var SlimeVolleyball,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};SlimeVolleyball=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,Scene),a.prototype.init=function(){var b,c;return this.world=new World(this.width,this.height),this.world.deterministic=!1,c=Globals.Loader,this.world.pole.bg=c.getAsset("pole"),this.bg=new StretchySprite(0,0,this.width,this.height,200,1,c.getAsset("bg")),this.p1Scoreboard=new Scoreboard(Constants.SCOREBOARD_PADDING,Constants.SCOREBOARD_PADDING,c.getAsset("score_a"),this.world.p1),this.p2Scoreboard=new Scoreboard(this.width-Constants.WIN_SCORE*Constants.POINT_WIDTH-Constants.SCOREBOARD_PADDING,Constants.SCOREBOARD_PADDING,c.getAsset("score_b"),this.world.p2),this.buttons={back:new Button(this.width/2-Constants.BACK_BTN_WIDTH/2,Constants.SCOREBOARD_PADDING,Constants.BACK_BTN_WIDTH,Constants.BACK_BTN_HEIGHT,c.getAsset("return"),c.getAsset("return"),this)},this.sprites=[],this.sprites.push(this.bg,this.world.pole,this.world.p1,this.world.p2,this.world.ball,this.p1Scoreboard,this.p2Scoreboard,this.buttons.back),b=new GamePad({left:[0,this.height-Constants.BOTTOM,Constants.ARROW_WIDTH,Constants.BOTTOM],right:[Constants.ARROW_WIDTH,this.height-Constants.BOTTOM,Constants.ARROW_WIDTH,Constants.BOTTOM],up:[2*Constants.ARROW_WIDTH,this.height-Constants.BOTTOM,this.width-2*Constants.ARROW_WIDTH,Constants.BOTTOM]}),this.buttons.gamepad=b,this.failMsgs=["you failed miserably!","try harder, young one.","not even close!","he wins, you lose!",'"hahaha!" shouts your opponent.',"*** YOU LOST THE GAME ***"],this.winMsgs=["nice shot!","good job!","you've got this!","keep it up!","either you're good, or you got lucky!","*** YOU WON THE GAME ***"],this.displayMsg=null,this.freezeGame=!1,this.keyState={left:!1,right:!1,up:!1},a.__super__.init.call(this)},a.prototype.inputChanged=function(){var a,b,c,d,e,f;c=Globals.Input,a=!1,f=this.keyState;for(d in f){if(!__hasProp.call(f,d))continue;e=f[d],b=c[d](0),e!==b&&(a=!0,this.keyState[d]=b)}return a},a.prototype.moveCPU=function(){this.ball.x>this.pole.x&&this.ball.y<200&&this.ball.y>150&&this.p2.jumpSpeed===0&&(this.p2.jumpSpeed=12),this.ball.x>this.pole.x-this.p1.width&&this.ball.x<this.p2.x&&(this.p2.x-=Constants.MOVEMENT_SPEED*.75+Constants.MOVEMENT_SPEED*Constants.AI_DIFFICULTY),this.ball.x>this.pole.x-this.p1.width&&this.ball.x+this.ball.width+this.ball.velocity.x*Constants.AI_DIFFICULTY>this.p2.x+this.p2.width&&this.ball.x+this.ball.width<this.width?this.p2.x+=Constants.MOVEMENT_SPEED*.75+Constants.MOVEMENT_SPEED*Constants.AI_DIFFICULTY:this.ball.x>this.pole.x-this.p1.width&&this.ball.x+this.ball.width+this.ball.velocity.x*Constants.AI_DIFFICULTY>this.p2.x+this.p2.width&&this.ball.x+this.ball.width>=this.width&&(this.p2.x-=Constants.MOVEMENT_SPEED*.75+Constants.MOVEMENT_SPEED*Constants.AI_DIFFICULTY);if(this.ball.x+this.ball.radius>this.p2.x+30&&this.ball.x+this.ball.radius<this.p2.x+34)return this.p2.x+=Constants.MOVEMENT_SPEED*.75+Constants.MOVEMENT_SPEED*Constants.AI_DIFFICULTY},a.prototype.draw=function(){var a,b,c,d,e;this.ctx.clearRect(0,0,this.width,this.height),e=this.sprites;for(c=0,d=e.length;c<d;c++)b=e[c],b.draw(this.ctx);if(this.displayMsg){this.ctx.font="bold 14px "+Constants.MSG_FONT,this.ctx.fillStyle="#ffffff",this.ctx.textAlign="center",a=this.displayMsg.split("\n"),this.ctx.fillText(a[0],this.width/2,85);if(a.length>1)return this.ctx.font="bold 11px "+Constants.MSG_FONT,this.ctx.fillText(a[1],this.width/2,110)}},a.prototype.handleWin=function(a){var b,c,d=this;this.freezeGame=!0,a.score++,this.world.ball.y=this.height-Constants.BOTTOM-this.world.ball.height,this.world.ball.velocity={x:0,y:0},this.world.ball.falling=!1,c=a===this.world.p1?this.winMsgs:this.failMsgs,b=a.score<Constants.WIN_SCORE?Helpers.rand(c.length-2):c.length-1,this.displayMsg=c[b];if(a.score<Constants.WIN_SCORE)return this.displayMsg+="\nGame restarts in 1 second...",setTimeout(function(){return d.world.reset(a),d.displayMsg=null,d.freezeGame=!1},1e3)},a.prototype.step=function(a){var b;return this.next(),this.freezeGame?this.draw():(this.world.p1.handleInput(Globals.Input),this.moveCPU.apply(this.world),this.world.step(),this.world.ball.y+this.world.ball.height>=this.world.height-Constants.BOTTOM&&(b=this.world.ball.x+this.world.ball.radius>this.width/2?this.world.p1:this.world.p2,this.handleWin(b)),this.draw())},a.prototype.buttonPressed=
function(a){return Globals.Manager.popScene()},a}();var NetworkSlimeVolleyball,s,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};window.io||(s=document.createElement("script"),s.setAttribute("src","/socket.io/socket.io.js"),document.head.appendChild(s)),NetworkSlimeVolleyball=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,SlimeVolleyball),a.prototype.init=function(){var b=this;return a.__super__.init.call(this),this.freezeGame=!0,this.displayMsg="Loading...",this.gameFrame=null,this.gameStateBuffer=[],this.networkInterpolationRemainder=0,this.world.deterministic=!0,this.socket&&this.socket.disconnect()&&(this.socket=null),this.socket=io.connect(),this.socket.on("connect",function(){return b.displayMsg="Connected. Waiting for opponent..."}),this.socket.on("gameInit",function(){return b.displayMsg="Opponent found! Game begins in 1 second..."}),this.socket.on("gameStart",function(){return console.log("here we go."),b.freezeGame=!1,b.displayMsg=null,b.start()}),this.socket.on("gameFrame",function(a){return console.log("gameFrame!"),b.gameFrame=a}),this.socket.on("roundEnd",function(a,c){return console.log("roundEnd!"+a),b.freezeGame=!0,a?(b.displayMsg=b.winMsgs[Helpers.rand(b.winMsgs.length-2)],b.p1.score+=1):(b.displayMsg=b.failMsgs[Helpers.rand(b.winMsgs.length-2)],b.p2.score+=1)}),this.socket.on("gameEnd",function(a){return b.freezeGame=!0}),this.socket.on("opponentLost",function(){return b.freezeGame=!0,b.displayMsg="Lost connection to opponent. Looking for new match..."}),this.socketInitialized=!0},a.prototype.start=function(){var b,c;for(b=0,c=Constants.FRAME_DELAY;0<=c?b<c:b>c;0<=c?b++:b--)this.world.step(Constants.TICK_DURATION),this.gameStateBuffer.push(this.world.getState());return a.__super__.start.call(this)},a.prototype.draw=function(){var a,b;this.gameStateBuffer&&(a=this.gameStateBuffer.shift());if(!a)return;this.ctx.clearRect(0,0,this.width,this.height),this.bg.draw(this.ctx),this.world.p1.draw(this.ctx,a.p1.x,a.p1.y),this.world.p2.draw(this.ctx,a.p2.x,a.p2.y),this.world.pole.draw(this.ctx),this.p1Scoreboard.draw(this.ctx),this.p2Scoreboard.draw(this.ctx),this.world.ball.draw(this.ctx,a.ball.x,a.ball.y),console.log(a.ball.y);if(this.displayMsg){this.ctx.font="bold 14px "+Constants.MSG_FONT,this.ctx.fillStyle="#ffffff",this.ctx.textAlign="center",b=this.displayMsg.split("\n"),this.ctx.fillText(b[0],this.width/2,85);if(b.length>1)return this.ctx.font="bold 11px "+Constants.MSG_FONT,this.ctx.fillText(b[1],this.width/2,110)}},a.prototype.step=function(a){var b;this.next(),this.gameFrame&&(b=this.gameFrame,this.gameFrame=null,console.log("setting state."),this.world.setState(b.state));if(this.freezeGame||!this.socketInitialized){this.gameStateBuffer&&this.gameStateBuffer.push(this.world.getState()),this.draw();return}return this.world.step(),this.gameStateBuffer.push(this.world.getState()),this.draw()},a.prototype.destroy=function(){return this.socket.disconnect()},a}();var InstructionsScene,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};InstructionsScene=function(){function a(){var b;a.__super__.constructor.call(this),this.bg=new StretchySprite(0,0,this.width,this.height,1,1,Globals.Loader.getAsset("instructions")),b=Globals.Loader.getAsset("back_arrow"),this.buttons={back:new Button(10,10,50,50,b,b,this)}}return __extends(a,Scene),a.prototype.step=function(a){var b,c,d,e;if(!this.ctx)return;this.next(),this.ctx.clearRect(0,0,this.width,this.height),this.bg.draw(this.ctx),d=this.buttons,e=[];for(c in d)b=d[c],e.push(b.draw(this.ctx));return e},a.prototype.buttonPressed=function(a){return Globals.Manager.popScene()},a}();var OptionsScene,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};OptionsScene=function(){function a(){var b;a.__super__.constructor.call(this),this.bg=new StretchySprite(0,0,this.width,this.height,1,1,Globals.Loader.getAsset("options")),b=Globals.Loader.getAsset("back_arrow"),this.buttons={back:new Button(10,10,50,50,b,b,this)},this.dragger=new Sprite(258,this.height-215-Constants.BALL_RADIUS,Constants.BALL_RADIUS*2,Constants.BALL_RADIUS*2,Globals.Loader.getAsset("ball"));try{this.percent=document.cookie.match(/AI_DIFFICULTY=(\d\.\d*)/i)[1]}catch(c){this.percent=Constants.AI_DIFFICULTY}finally{Constants.AI_DIFFICULTY=this.percent}this.mdown=!1}return __extends(a,Scene),a.prototype.step=function(a){var b,c,d;if(!this.ctx)return;this.next(),this.ctx.clearRect(0,0,this.width,this.height),this.bg.draw(this.ctx),d=this.buttons;for(c in d)b=d[c],b.draw(this.ctx);return this.dragger.x=this.percent*192+258-this.dragger.width/2,this.dragger.draw(this.ctx)},a.prototype.buttonPressed=function(a){return Globals.Manager.popScene()},a.prototype.mousedown=function(b){return Helpers.inRect(b.x,b.y,244,this.height-240,225,52)&&(this.mdown=!0,this.percent=Math.max(Math.min((b.x-244)/225,1),0),Constants.AI_DIFFICULTY=this.percent,document.cookie="AI_DIFFICULTY="+this.percent),a.__super__.mousedown.call(this,b)},a.prototype.mousemove=function(b){return this.mdown&&(this.percent=Math.max(Math.min((b.x-244)/225,1),0),Constants.AI_DIFFICULTY=this.percent,document.cookie="AI_DIFFICULTY="+this.percent),a.__super__.mousemove.call(this,b)},a.prototype.mouseup=function(b){return this.mdown=!1,a.__super__.mouseup.call(this,b)},a.prototype.mouseout=function(b){return this.mdown=!1,a.__super__.mouseout.call(this,b)},a}(),window.onload=function(){var a;return Globals.Manager.canvas=document.getElementById("canvas"),Globals.Manager.ctx=Globals.Manager.canvas.getContext("2d"),Globals.Input=new Input,a=new LoadingScene,Globals.Manager.pushScene(a),a.start()}