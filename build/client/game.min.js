((function(){var a,b,c,d,e;a=0,b=["ms","moz","webkit","o"],d=function(a){return window.requestAnimationFrame=window[b[a]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[a]+"CancelAnimationFrame"]||window[b[a]+"CancelRequestAnimationFrame"]};for(c=0,e=b.length;0<=e?c<=e:c>=e;0<=e?c++:c--)d.call(this,c);window.requestAnimationFrame||(window.requestAnimationFrame=function(b,c){var d,e,f;return d=(new Date).getTime(),f=Math.max(0,16-(d-a)),e=window.setTimeout(function(){return b(d+f)},f),a=d+f,e});if(!window.cancelAnimationFrame)return window.cancelAnimationFrame=function(a){return window.clearTimeout(a)}})).call(this),CanvasRenderingContext2D.prototype.roundRect=function(a,b,c,d,e){return c<2*e&&(e=c/2),d<2*e&&(e=d/2),this.beginPath(),this.moveTo(a+e,b),this.arcTo(a+c,b,a+c,b+d,e),this.arcTo(a+c,b+d,a,b+d,e),this.arcTo(a,b+d,a,b,e),this.arcTo(a,b,a+c,b,e),this.closePath(),this},window.addEventListener||(window.addEventListener=function(a,b,c){return window.attachEvent?window.attachEvent("on"+a,b):window["on"+a]=b}),window.addEventListener("load",function(){return setTimeout(function(){return window.scrollTo(0,1)},0)}),window.module||(window.module=!1);var Constants;Constants={SCALE:.1,SCALE_INV:10,BOTTOM:60,BASE_WIDTH:480,BASE_HEIGHT:320,JUMP_ACCEL:-38,MOVE_ACCEL:25,GRAVITY:50,ARROW_WIDTH:121,SET_DELAY:800,WIN_SCORE:6,POINT_WIDTH:20,SCOREBOARD_PADDING:20,BACK_BTN_WIDTH:108,BACK_BTN_HEIGHT:26,BALL_START_HEIGHT:260,SLIME_RADIUS:32,BALL_RADIUS:10,MOVEMENT_SPEED:4,JUMP_SPEED:12,SLIME_START_HEIGHT:91,AI_DIFFICULTY:1,MSG_FONT:"Courier, monospace, sans-serif",SERVER_TICK_DURATION:16,FRAME_DROP_THRESHOLD:20,ASSETS:{p1:"assets/images/s_0.png",p2:"assets/images/s_1.png",bg:"assets/images/bg.png",ball:"assets/images/ball.png",eye:"assets/images/eye.png",menu_bg:"assets/images/menu_bg.png",logo:"assets/images/logo.png",btn_instructions:"assets/images/btn_instructions.png",btn_one:"assets/images/btn_one.png",btn_options:"assets/images/btn_options.png",btn_wifi:"assets/images/btn_wifi.png",btn_a:"assets/images/btn_a.png",btn_b:"assets/images/btn_b.png",pole:"assets/images/pole.png",blank_point:"assets/images/blank_point.png","return":"assets/images/return.png",score_a:"assets/images/score_a.png",score_b:"assets/images/score_b.png",instructions:"assets/images/instructions.png",back_arrow:"assets/images/back_arrow.png"}},module&&(module.exports=Constants);var Helpers;Helpers={round:function(a){return.5+a<<0},inRect:function(a,b,c,d,e,f){return a>c&&a<c+e&&b>d&&b<d+f},deg2Rad:function(a){return a*Math.PI/180},rad2Deg:function(a){return a*180/Math.PI},yFromAngle:function(a){return-Math.cos(Helpers.deg2Rad(a))},xFromAngle:function(a){return Math.sin(Helpers.deg2Rad(a))},rand:function(a){return Math.floor(Math.random()*(a+1))},dist:function(a,b){return Math.sqrt(Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2))},velocityMag:function(a){return Math.sqrt(Math.pow(a.velocity.x,2)+Math.pow(a.velocity.y,2))}},module&&(module.exports=Helpers);var SceneManager;SceneManager=function(){function a(a){this.canvas=a,this.sceneStack=[],this.currScene=null}return a.prototype.pushScene=function(a){return this.sceneStack.push(a),this.currScene&&(this.currScene.stop(),this.currScene.ctx=null),this.currScene=a,this.currScene.ctx=this.ctx,this.currScene.initialized?this.currScene.start():this.currScene.init()},a.prototype.popScene=function(){var a;return this.currScene&&(this.currScene.stop(),this.currScene.ctx=null),a=this.sceneStack.pop(),a&&a.destroy&&a.destroy(),this.currScene=this.sceneStack[this.sceneStack.length-1]||null,this.currScene&&(this.currScene.ctx=this.ctx,this.currScene.start()),a},a}();var Scene,__hasProp=Object.prototype.hasOwnProperty;Scene=function(){function a(){var a=this;this.stopped=!0,this.initialized=!1,this.lastTimeout=0,this.width=Globals.Manager.canvas.width,this.height=Globals.Manager.canvas.height,this.center={x:this.width/2,y:this.height/2},this.canvas=Globals.Manager.canvas,this.ctx=this.canvas.getContext("2d"),this.buttons||(this.buttons={}),this.stepCallback=function(b){return a.step(b)}}return a.prototype.init=function(){return this.stopped=!1,this.initialized=!0,this.step((new Date).getTime())},a.prototype.start=function(){return this.stopped=!1,this.step((new Date).getTime())},a.prototype.step=function(a){return console.log("Implement me!!!")},a.prototype.next=function(){if(!this.stopped)return this.lastTimeout=window.requestAnimationFrame(this.stepCallback)},a.prototype.stop=function(){return this.stopped=!0,window.cancelAnimationFrame(this.lastTimeout)},a.prototype.click=function(a){var b,c,d,e;d=this.buttons,e=[];for(c in d){if(!__hasProp.call(d,c))continue;b=d[c],e.push(b.handleClick(a))}return e},a.prototype.mousedown=function(a){var b,c,d,e;d=this.buttons,e=[];for(c in d){if(!__hasProp.call(d,c))continue;b=d[c],e.push(b.handleMouseDown(a))}return e},a.prototype.mousemove=function(a){var b,c,d,e;d=this.buttons,e=[];for(c in d){if(!__hasProp.call(d,c))continue;b=d[c],e.push(b.handleMouseMove(a))}return e},a.prototype.mouseup=function(a){var b,c,d,e;d=this.buttons,e=[];for(c in d){if(!__hasProp.call(d,c))continue;b=d[c],e.push(b.handleMouseUp(a))}return e},a.prototype.buttonPressed=function(){},a}();var Loader;Loader=function(){function a(){this.progress=0,this.assets={},this.totalAssets=0,this.loadedAssets=0}return a.prototype.updateProgress=function(){this.progress=this.loadedAssets/this.totalAssets,this.onprogress&&this.onprogress(this.progress);if(this.progress===1&&this.onload)return this.onload()},a.prototype.load=function(a){var b,c,d;d=[];for(c in a)b=a[c],d.push(this.loadAsset(c,b));return d},a.prototype.loadAsset=function(a,b){var c,d;return c=new Image,d=this,c.onload=function(){return this.loaded=!0,d.loadedAssets++,d.updateProgress()},this.assets[a]={loader:this,src:b,image:c},this.totalAssets++,c.src=b},a.prototype.loadProgress=function(a){return this.onprogress=a},a.prototype.loadComplete=function(a){return this.onload=a},a.prototype.getAsset=function(a){return this.assets[a].image},a}();var Input;Input=function(){function a(){var a,b,c,d,e,f,g,h,i,j,k,l,m;this.keys={},l=this.keys,m=this,this.anyInput=!1,j=function(a){return a.which||(a.which=a.charCode),a.which||(a.which=a.keyCode),a},i=function(a){var b,c;return c=Globals.Manager.canvas,b=c.getBoundingClientRect(),a.x=(a.x-b.left)*(c.width/b.width),a.y=(a.y-b.top)*(c.height/b.height),a},k=function(a){var b,c,d;return b=Globals.Manager.canvas,c=a.clientX||a.x||a.layerX,d=a.clientY||a.y||a.layerY,i({x:c,y:d,identifier:a.identifier})},c=function(a){return m.anyInput=!0,l["key"+j(a).which]=!0},d=function(a){return m.anyInput=!1,l["key"+j(a).which]=!1},g=function(a){return m.anyInput=!1,a=k(a),Globals.Manager.currScene.mouseup(a)},e=function(a){return m.anyInput=!0,a=k(a),Globals.Manager.currScene.mousedown(a)},f=function(a){return a=k(a),Globals.Manager.currScene.mousemove(a)},b=function(a){return a=k(a),Globals.Manager.currScene.click(a)},h=function(a){return function(a){return function(b){var c,d,e,f;b.preventDefault(),f=b.changedTouches;for(d=0,e=f.length;d<e;d++)c=f[d],a({x:c.clientX,y:c.clientY,identifier:c.identifier})}}.call(this,a)},a=Globals.Manager.canvas,document.addEventListener("keydown",c,!0),document.addEventListener("keyup",d,!0),a.addEventListener("mouseup",g,!0),a.addEventListener("mousedown",e,!0),a.addEventListener("mousemove",f,!0),a.addEventListener("click",b,!0),document.documentElement.addEventListener("touchstart",h(e),!0),document.documentElement.addEventListener("touchend",h(g),!0),window.addEventListener("touchmove",h(f),!0),window.addEventListener("touchcancel",h(g),!0),this.shortcuts={left:["key37","key65"],right:["key39","key68"],up:["key38","key87"],down:["key40","key83"]}}return a.prototype.left=function(a){return this.keys[this.shortcuts.left[a]]||!1},a.prototype.right=function(a){return this.keys[this.shortcuts.right[a]]||!1},a.prototype.up=function(a){return this.keys[this.shortcuts.up[a]]||!1},a.prototype.down=function(a){return this.keys[this.shortcuts.down[a]]||!1},a.prototype.reset=function(){var a,b,c,d;c=this.keys,d=[];for(a in c)b=c[a],d.push(this.keys[a]=!1);return d},a.prototype.set=function(a,b,c){return c==null&&(c=0),this.keys[this.shortcuts[a][c]]=b},a}();var Sprite;Sprite=function(){function a(a,b,c,d,e){this.x=a,this.y=b,this.width=c,this.height=d,this.bg=e,this.velocity={x:0,y:0}}return a.prototype.setPosition=function(a,b){return a.y&&(b=a.y),a.x&&(a=a.x),this.x=a,this.y=b},a.prototype.incrementPosition=function(){return this.x+=this.velocity.x,this.y+=this.velocity.y},a.prototype.draw=function(a){if(this.bg)return a.drawImage(this.bg,Helpers.round(this.x),Helpers.round(this.y))},a}(),module&&(module.exports=Sprite);var Button,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};Button=function(){function a(b,c,d,e,f,g,h){this.x=b,this.y=c,this.width=d,this.height=e,this.img=f,this.downImg=g,this.scene=h,this.down=!1,a.__super__.constructor.call(this,this.x,this.y,this.width,this.height,this.img)}return __extends(a,Sprite),a.prototype.handleMouseDown=function(a){return this.down=Helpers.inRect(a.x,a.y,this.x,this.y,this.width,this.height)},a.prototype.handleMouseUp=function(a){return this.down&&Helpers.inRect(a.x,a.y,this.x,this.y,this.width,this.height)&&this.scene&&this.scene.buttonPressed(this),this.down=!1},a.prototype.handleMouseMove=function(a){if(this.down)return this.down=Helpers.inRect(a.x,a.y,this.x,this.y,this.width,this.height)},a.prototype.handleClick=function(a){this.down=!1;if(Helpers.inRect(a.x,a.y,this.x,this.y,this.width,this.height)&&this.scene)return this.scene.buttonPressed(this)},a.prototype.draw=function(a){if(!this.img)return;return a.drawImage(this.down?this.downImg:this.img,Helpers.round(this.x),Helpers.round(this.y))},a}();var GamePad;GamePad=function(){function a(a){this.btnRects=a,this.previousPos={}}return a.prototype.inRect=function(a,b){return a?Helpers.inRect(a.x,a.y,b[0],b[1],b[2],b[3]):!1},a.prototype.findRect=function(a){var b,c,d;d=this.btnRects;for(b in d){c=d[b];if(this.inRect(a,c))return b}return null},a.prototype.savePreviousPos=function(a){return this.previousPos[(a.identifier||"0")+""]=a},a.prototype.getPreviousPos=function(a){return this.previousPos[(a.identifier||"0")+""]},a.prototype.handleMouseDown=function(a){var b;return b=this.findRect(a),b&&Globals.Input.set(b,!0),this.savePreviousPos(a)},a.prototype.handleMouseMove=function(a){var b,c,d;if(!a.identifier)return;b=this.findRect(a),d=this.getPreviousPos(a),c=d?this.findRect(d):null,this.savePreviousPos(a);if(c&&b===c)return Globals.Input.set(c,!0);if(c&&b!==c){Globals.Input.set(c,!1);if(b)return Globals.Input.set(b,!1)}},a.prototype.handleMouseUp=function(a){var b;return b=this.findRect(a),b&&Globals.Input.set(b,!1),this.savePreviousPos(a)},a.prototype.handleClick=function(){},a}();var Globals;Globals={Input:null,Manager:new SceneManager,Loader:new Loader};var StretchySprite,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};StretchySprite=function(){function a(b,c,d,e,f,g,h){this.x=b,this.y=c,this.width=d,this.height=e,this.rightCap=f,this.topCap=g,this.bg=h,this.generateStretchedImage(),a.__super__.constructor.call(this,this.x,this.y,this.width,this.height)}return __extends(a,Sprite),a.prototype.generateStretchedImage=function(){var a,b,c,d,e,f,g,h;return a=function(a,b){var c;return c=document.createElement("canvas"),c.width=a,c.height=b,c},f=a(this.width,2),c=a(8,this.height),g=f.getContext("2d"),g.drawImage(this.bg,0,this.topCap,this.bg.width,1,0,0,this.width,f.height),d=c.getContext("2d"),d.drawImage(this.bg,this.bg.width-this.rightCap-c.width,0,c.width,this.bg.height,0,this.height-this.bg.height,c.width,this.bg.height),this.stretchedImage=a(this.width,this.height),b=this.stretchedImage.getContext("2d"),b.drawImage(this.bg,this.x,this.y+this.height-this.bg.height),e=b.createPattern(c,"repeat-x"),b.fillStyle=e,b.fillRect(this.bg.width-this.rightCap,this.height-this.bg.height,this.width-this.bg.width,this.bg.height),h=b.createPattern(f,"repeat-y"),b.fillStyle=h,b.fillRect(0,this.topCap,this.width,this.height-this.bg.height),b.drawImage(this.bg,0,0,this.bg.width,this.topCap,0,0,this.width,this.topCap),b.drawImage(this.bg,this.bg.width-this.rightCap,0,this.rightCap,this.bg.height,this.width-this.rightCap,this.height-this.bg.height,this.rightCap,this.bg.height)},a.prototype.draw=function(a){return a.drawImage(this.stretchedImage,0,0)},a}();var Ball,Sprite,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};module&&(Sprite=require("./sprite")),Ball=function(){function a(b,c,d,e){this.x=b,this.y=c,this.radius=d,this.bg=e,this.falling=!0,a.__super__.constructor.call(this,this.x,this.y,this.radius*2,this.radius*2,this.bg)}return __extends(a,Sprite),a.prototype.applyGravity=function(){if(!this.falling)return;this.velocity.y<10?this.velocity.y+=.2:this.velocity.y=10,this.velocity.x>=.03&&(this.velocity.x-=.01);if(this.velocity.x<=-0.03)return this.velocity.x+=.01},a}(),module&&(module.exports=Ball);var Constants,Slime,Sprite,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};module&&(Sprite=require("./sprite"),Constants=require("./constants")),Slime=function(){function a(b,c,d,e,f){this.x=b,this.y=c,this.color=d,this.img=e,this.eyeImg=f,this.radius=Constants.SLIME_RADIUS,this.isP2=!1,this.score=0,this.gravTime=0,this.falling=!0,this.jumpSpeed=0,a.__super__.constructor.call(this,this.x,this.y,this.radius*2,this.radius,this.img)}return __extends(a,Sprite),a.prototype.handleInput=function(a,b){var c;c=this.isP2?1:0,a.left(c)&&(this.x-=Constants.MOVEMENT_SPEED),a.right(c)&&(this.x+=Constants.MOVEMENT_SPEED);if(a.up(c)&&this.jumpSpeed<.01)return this.jumpSpeed=Constants.JUMP_SPEED},a.prototype.incrementGravity=function(){if(this.gravTime<600)return this.gravTime++},a.prototype.applyGravity=function(){return this.y+=50*(this.gravTime/60)},a.prototype.draw=function(b){var c,d,e,f,g,h;return a.__super__.draw.call(this,b),h=this.radius/2,g=h*.95,this.isP2&&(g=-g),e=[this.x+g,this.y-h],f=[g,h],c=[this.ball.x,this.ball.y],c[0]-=e[0],c[1]-=e[1],c[1]=-c[1],d=Math.sqrt(Math.pow(c[0],2)+Math.pow(c[1],2)),c[0]=c[0]/d*3+f[0],c[1]=c[1]/d*3+f[1],b.drawImage(this.eyeImg,Helpers.round(this.x+c[0]-2+this.radius),Helpers.round(this.y-c[1]-2+this.radius))},a}(),module&&(module.exports=Slime);var Scoreboard,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};Scoreboard=function(){function a(b,c,d,e,f,g,h,i){this.x=b,this.y=c,this.width=d,this.height=e,this.blankImg=f,this.pointImg=g,this.bgImg=h,this.slime=i,a.__super__.constructor.call(this,this.x,this.y,this.width,this.height)}return __extends(a,Sprite),a.prototype.draw=function(a){var b,c,d,e,f;c=Constants.POINT_WIDTH,a.drawImage(this.bgImg,this.x,this.y);for(b=0,d=this.slime.score;0<=d?b<d:b>d;0<=d?b++:b--)a.drawImage(this.pointImg,this.x+b*c+3,this.y+2);for(b=e=this.slime.score,f=Constants.WIN_SCORE;e<=f?b<f:b>f;e<=f?b++:b--)a.drawImage(this.blankImg,this.x+b*c+3,this.y+2)},a}();var Constants,Helpers,World;module&&(Constants=require("./constants"),Helpers=require("./helpers")),World=function(){function a(a,b,c,d,e,f){this.width=a,this.height=b,this.p1=c,this.p2=d,this.ball=e,this.pole=f,this.needsUpdate=!1}return a.prototype.resolveCollision=function(a,b){var c,d,e;return c=[a.x+a.radius,this.height-(a.y+a.radius)],d=[b.x+b.radius,this.height-(b.y+b.radius)],c[0]-=d[0],c[1]-=d[1],e=Math.sqrt(Math.pow(c[0],2)+Math.pow(c[1],2)),c[0]=c[0]/e*(b.radius+a.radius)+b.x+b.radius,c[1]=c[1]/e*(b.radius+a.radius)+this.height-b.y-b.radius,{x:c[0]-this.ball.radius,y:this.height-(c[1]+this.ball.radius)}},a.prototype.step=function(){var a,b,c,d;this.needsUpdate=!1,this.ball.incrementPosition(),this.ball.applyGravity(),this.p1.falling&&(this.p1.y-=this.p1.jumpSpeed,this.p1.incrementGravity(),this.p1.applyGravity()),this.p2.falling&&(this.p2.y-=this.p2.jumpSpeed,this.p2.incrementGravity(),this.p2.applyGravity()),this.p1.y+this.p1.height>this.height-Constants.BOTTOM?(this.p1.y=this.height-Constants.BOTTOM-this.p1.height,this.p1.falling=!1,this.p1.gravTime=0,this.p1.jumpSpeed=0):this.p1.falling=!0,this.p2.y+this.p2.height>this.height-Constants.BOTTOM?(this.p2.y=this.height-Constants.BOTTOM-this.p2.height,this.p2.falling=!1,this.p2.gravTime=0,this.p2.jumpSpeed=0):this.p2.falling=!0,this.ball.y+this.ball.height<this.p1.y+this.p1.height&&Math.sqrt(Math.pow(this.ball.x+this.ball.radius-(this.p1.x+this.p1.radius),2)+Math.pow(this.ball.y+this.ball.radius-(this.p1.y+this.p1.radius),2))<this.ball.radius+this.p1.radius&&(a=Helpers.rad2Deg(Math.atan(-(this.ball.x+this.ball.radius-(this.p1.x+this.p1.radius))/(this.ball.y+this.ball.radius-(this.p1.y+this.p1.radius)))),this.ball.velocity.x=Helpers.xFromAngle(a)*(6.5+1.5*Constants.AI_DIFFICULTY),this.ball.velocity.y=Helpers.yFromAngle(a)*(6.5+1.5*Constants.AI_DIFFICULTY),this.ball.setPosition(this.resolveCollision(this.ball,this.p1)),this.needsUpdate=!0),this.ball.y+this.ball.height<this.p2.y+this.p2.radius&&Math.sqrt(Math.pow(this.ball.x+this.ball.radius-(this.p2.x+this.p2.radius),2)+Math.pow(this.ball.y+this.ball.radius-(this.p2.y+this.p2.radius),2))<this.ball.radius+this.p2.radius&&(a=Helpers.rad2Deg(Math.atan(-(this.ball.x+this.ball.radius-(this.p2.x+this.p2.radius))/(this.ball.y+this.ball.radius-(this.p2.y+this.p2.radius)))),this.ball.velocity.x=Helpers.xFromAngle(a)*(6.5+1.5*Constants.AI_DIFFICULTY),this.ball.velocity.y=Helpers.yFromAngle(a)*(6.5+1.5*Constants.AI_DIFFICULTY),this.ball.setPosition(this.resolveCollision(this.ball,this.p2)),this.needsUpdate=!0),this.ball.x+this.ball.width>this.width?(this.ball.x=this.width-this.ball.width,this.ball.velocity.x*=-1,this.ball.velocity.y=Helpers.yFromAngle(180-this.ball.velocity.x/this.ball.velocity.y)*this.ball.velocity.y,Math.abs(this.ball.velocity.x)<=.1&&(this.ball.velocity.x=-1),this.needsUpdate=!0):this.ball.x<0&&(this.ball.x=0,this.ball.velocity.x*=-1,this.ball.velocity.y=Helpers.yFromAngle(180-this.ball.velocity.x/this.ball.velocity.y)*this.ball.velocity.y,Math.abs(this.ball.velocity.x)<=.1&&(this.ball.velocity.x=1),this.needsUpdate=!0),b=2;if(this.ball.x+this.ball.width>this.pole.x&&this.ball.x<this.pole.x+this.pole.width&&this.ball.y+this.ball.height>=this.pole.y&&this.ball.y<=this.pole.y+this.pole.height){if(this.ball.y+this.ball.radius>=this.pole.y+b)return this.ball.x=this.ball.velocity.x>0?this.pole.x-this.ball.width:this.pole.x+this.pole.width,this.ball.velocity.x*=-1,this.ball.velocity.y=Helpers.yFromAngle(180-this.ball.velocity.x/this.ball.velocity.y)*this.ball.velocity.y,this.needsUpdate=!0;if(this.ball.x+this.ball.radius<this.pole.x+b){c={x:this.pole.x+b,y:this.pole.y+b,radius:b},d=Math.sqrt(Math.pow(this.ball.x+this.ball.radius-c.x,2)+Math.pow(this.ball.y+this.ball.radius-c.y,2));if(d<c.radius+this.ball.radius)return a=Helpers.rad2Deg(Math.atan(-(this.ball.x+this.ball.radius-(c.x+c.radius))/(this.ball.y+this.ball.radius-(c.y+c.radius)))),this.ball.velocity.x=Helpers.xFromAngle(a)*6,this.ball.velocity.y=Helpers.yFromAngle(a)*6,this.ball.setPosition(this.resolveCollision(this.ball,c)),this.needsUpdate=!0}else{if(!(this.ball.x+this.ball.radius>this.pole.x+this.pole.width-b))return this.ball.velocity.y*=-1,Math.abs(this.ball.velocity.x)<.1&&(this.ball.velocity.x=.5),this.ball.y=this.pole.y-this.ball.height,this.needsUpdate=!0;c={x:this.pole.x+this.pole.width-b,y:this.pole.y+b,radius:b},d=Math.sqrt(Math.pow(this.ball.x+this.ball.radius-c.x,2)+Math.pow(this.ball.y+this.ball.radius-c.y,2));if(d<c.radius+this.ball.radius)return a=Helpers.rad2Deg(Math.atan(-(this.ball.x+this.ball.radius-(c.x+c.radius))/(this.ball.y+this.ball.radius-(c.y+c.radius)))),this.ball.velocity.x=Helpers.xFromAngle(a)*6,this.ball.velocity.y=Helpers.yFromAngle(a)*6,this.ball.setPosition(this.resolveCollision(this.ball,c)),this.needsUpdate=!0}}else if(this.ball.x<this.pole.x+this.pole.width&&this.ball.x>this.pole.x+this.ball.velocity.x&&this.ball.y>=this.pole.y&&this.ball.y<=this.pole.y+this.pole.height&&this.ball.velocity.x<0)return this.ball.y+this.ball.height>=this.pole.y+b?(this.ball.x=this.pole.x+this.pole.width,this.ball.velocity.x*=-1,this.ball.velocity.y=Helpers.yFromAngle(180-this.ball.velocity.x/this.ball.velocity.y)*this.ball.velocity.y,this.needsUpdate=!0):(this.ball.velocity.y*=-1,Math.abs(this.ball.velocity.x)<.1&&(this.ball.velocity.x=.5),this.ball.y=this.pole.y-this.ball.height,this.needsUpdate=!0)},a.prototype.boundsCheck=function(){this.p1.x<0&&(this.p1.x=0),this.p1.x+this.p1.width>this.pole.x&&(this.p1.x=this.pole.x-this.p1.width),this.p2.x<this.pole.x+this.pole.width&&(this.p2.x=this.pole.x+this.pole.width);if(this.p2.x>this.width-this.p2.width)return this.p2.x=this.width-this.p2.width},a}(),module&&(module.exports=World);var LoadingScene,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};LoadingScene=function(){function a(){this.loadStarted=!1,this.progress=0,a.__super__.constructor.call(this)}return __extends(a,Scene),a.prototype.start=function(){var b;return b=this,this.loadStarted||(this.loadStarted=!0,Globals.Loader.loadProgress(function(a){return b.loadProgress(a,b)}),Globals.Loader.loadComplete(function(){return b.loadComplete()}),Globals.Loader.load(Constants.ASSETS)),a.__super__.start.call(this)},a.prototype.loadComplete=function(){return Globals.Manager.popScene(),Globals.Manager.pushScene(new MenuScene)},a.prototype.loadProgress=function(a,b){return this.progress=a,b.next()},a.prototype.step=function(a){if(!this.ctx)return;return this.ctx.clearRect(0,0,this.width,this.height),this.ctx.fillStyle="#444",this.ctx.fillRect(0,0,this.width,this.height),this.ctx.strokeStyle="#111",this.ctx.lineWidth=1,this.ctx.roundRect(Helpers.round(this.center.x-35),Helpers.round(this.center.y-5),70,10,2).stroke(),this.ctx.fillStyle="#444",this.ctx.roundRect(Helpers.round(this.center.x-35),Helpers.round(this.center.y-5),70,10,2).fill(),this.ctx.fillStyle="#0f0",this.ctx.roundRect(Helpers.round(this.center.x-35),Helpers.round(this.center.y-5),70*this.progress,10,2).fill(),this.ctx.font="12px Monaco, Courier New, Courier, san-serif",this.ctx.textAlign="center",this.ctx.fillStyle="#bbb",this.ctx.fillText("Loading...",Helpers.round(this.center.x),Helpers.round(this.center.y+25))},a}();var MenuScene,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};MenuScene=function(){function a(){var b,c,d,e,f,g,h,i,j,k,l;a.__super__.constructor.call(this),g=Globals.Loader,this.bg=new StretchySprite(0,0,this.width,this.height,1,1,g.getAsset("menu_bg")),this.logo=new Sprite(this.center.x-128,this.center.y-155,256,256,g.getAsset("logo")),this.logo.velocity=0,d=this.center.y+30,c=234,b=44,h=58,this.buttons={instructions:new Button((this.center.x-c)/2,d+h,c,b,g.getAsset("btn_a"),g.getAsset("btn_b"),this),onePlayer:new Button((this.center.x-c)/2,d,c,b,g.getAsset("btn_a"),g.getAsset("btn_b"),this),options:new Button(this.center.x+(this.center.x-c)/2,d+h,c,b,g.getAsset("btn_a"),g.getAsset("btn_b"),this),wifi:new Button(this.center.x+(this.center.x-c)/2,d,c,b,g.getAsset("btn_a"),g.getAsset("btn_b"),this)},this.labels=[],f=["btn_wifi","btn_options","btn_one","btn_instructions"],l=["instructions","onePlayer","options","wifi"],i=function(a){return this.labels.push(new Sprite(a.x,a.y,a.width,a.height,g.getAsset(f.pop())))};for(j=0,k=l.length;j<k;j++)e=l[j],i.call(this,this.buttons[e]);this.instructions=new InstructionsScene}return __extends(a,Scene),a.prototype.step=function(a){var b,c,d,e,f,g,h;if(!this.ctx)return;this.next(),this.ctx.clearRect(0,0,this.width,this.height),this.bg.draw(this.ctx),this.logo.draw(this.ctx),g=this.buttons;for(c in g)b=g[c],b.draw(this.ctx);h=this.labels;for(e=0,f=h.length;e<f;e++)d=h[e],d.draw(this.ctx);return this.logo.y+=Math.sin(Math.PI/180*this.logo.velocity)/3,this.logo.velocity+=2},a.prototype.buttonPressed=function(a){if(a===this.buttons.instructions)return Globals.Manager.pushScene(this.instructions);if(a===this.buttons.onePlayer)return Globals.Manager.pushScene(new SlimeVolleyball);if(a!==this.buttons.options&&a===this.buttons.wifi)return Globals.Manager.pushScene(new NetworkSlimeVolleyball)},a}();var SlimeVolleyball,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};SlimeVolleyball=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,Scene),a.prototype.init=function(){var b,c,d,e,f;this.sprites=[],e=Globals.Loader,this.bg=new StretchySprite(0,0,this.width,this.height,200,1,e.getAsset("bg")),this.p1=new Slime(this.width/4-Constants.SLIME_RADIUS,this.height-Constants.SLIME_START_HEIGHT,"#0f0",e.getAsset("p1"),e.getAsset("eye")),this.p2=new Slime(3*this.width/4-Constants.SLIME_RADIUS,this.height-Constants.SLIME_START_HEIGHT,"#00f",e.getAsset("p2"),e.getAsset("eye")),this.ball=new Ball(this.width/4-Constants.BALL_RADIUS,this.height-Constants.BALL_START_HEIGHT,Constants.BALL_RADIUS,e.getAsset("ball")),this.pole=new Sprite(this.center.x-4,this.height-60-64-1,8,64,e.getAsset("pole")),this.p1.ball=this.p2.ball=this.ball,this.p2.isP2=!0,this.p1Scoreboard=new Scoreboard(Constants.SCOREBOARD_PADDING,Constants.SCOREBOARD_PADDING,Constants.POINT_WIDTH*Constants.WIN_SCORE,Constants.POINT_WIDTH,e.getAsset("blank_point"),e.getAsset("ball"),e.getAsset("score_a"),this.p1),this.p2Scoreboard=new Scoreboard(this.width-Constants.WIN_SCORE*Constants.POINT_WIDTH-Constants.SCOREBOARD_PADDING,Constants.SCOREBOARD_PADDING,Constants.POINT_WIDTH*Constants.WIN_SCORE,Constants.POINT_WIDTH,e.getAsset("blank_point"),e.getAsset("ball"),e.getAsset("score_b"),this.p2),this.sprites.push(this.bg),this.sprites.push(this.pole),this.sprites.push(this.p1),this.sprites.push(this.p2),this.sprites.push(this.ball),this.sprites.push(this.p1Scoreboard),this.sprites.push(this.p2Scoreboard),this.world=new World(this.width,this.height,this.p1,this.p2,this.ball,this.pole),this.buttons={back:new Button(this.width/2-Constants.BACK_BTN_WIDTH/2,Constants.SCOREBOARD_PADDING,Constants.BACK_BTN_WIDTH,Constants.BACK_BTN_HEIGHT,e.getAsset("return"),e.getAsset("return"),this)},f=this.buttons;for(d in f){if(!__hasProp.call(f,d))continue;b=f[d],this.sprites.push(b)}return c=new GamePad({left:[0,this.height-Constants.BOTTOM,Constants.ARROW_WIDTH,Constants.BOTTOM],right:[Constants.ARROW_WIDTH,this.height-Constants.BOTTOM,Constants.ARROW_WIDTH,Constants.BOTTOM],up:[2*Constants.ARROW_WIDTH,this.height-Constants.BOTTOM,this.width-2*Constants.ARROW_WIDTH,Constants.BOTTOM]}),this.buttons.gamepad=c,this.failMsgs=["you failed miserably!","try harder, young one.","not even close!","he wins, you lose!",'"hahaha!" shouts your opponent.',"*** YOU LOST THE GAME ***"],this.winMsgs=["nice shot!","good job!","you've got this!","keep it up!","either you're good, or you got lucky!","*** YOU WON THE GAME ***"],this.displayMsg=null,this.restartPause=-1,this.whoWon="NONE",this.freezeGame=!1,this.ball.velocity={x:0,y:2},a.__super__.init.call(this)},a.prototype.moveCPU=function(){this.ball.x>this.pole.x&&this.ball.y<200&&this.ball.y>150&&this.p2.jumpSpeed===0&&(this.p2.jumpSpeed=12),this.ball.x>this.pole.x-this.p1.width&&this.ball.x<this.p2.x&&(this.p2.x-=Constants.MOVEMENT_SPEED*.75+Constants.MOVEMENT_SPEED*Constants.AI_DIFFICULTY),this.ball.x>this.pole.x-this.p1.width&&this.ball.x+this.ball.width+this.ball.velocity.x*Constants.AI_DIFFICULTY>this.p2.x+this.p2.width&&this.ball.x+this.ball.width<this.width?this.p2.x+=Constants.MOVEMENT_SPEED*.75+Constants.MOVEMENT_SPEED*Constants.AI_DIFFICULTY:this.ball.x>this.pole.x-this.p1.width&&this.ball.x+this.ball.width+this.ball.velocity.x*Constants.AI_DIFFICULTY>this.p2.x+this.p2.width&&this.ball.x+this.ball.width>=this.width&&(this.p2.x-=Constants.MOVEMENT_SPEED*.75+Constants.MOVEMENT_SPEED*Constants.AI_DIFFICULTY);if(this.ball.x+this.ball.radius>this.p2.x+30&&this.ball.x+this.ball.radius<this.p2.x+34)return this.p2.x+=Constants.MOVEMENT_SPEED*.75+Constants.MOVEMENT_SPEED*Constants.AI_DIFFICULTY},a.prototype.handlePause=function(){this.restartPause++;if(this.restartPause===60)return this.p1.x=this.width/4-Constants.SLIME_RADIUS,this.p1.y=this.height-Constants.SLIME_START_HEIGHT,this.p2.x=3*this.width/4-Constants.SLIME_RADIUS,this.p2.y=this.height-Constants.SLIME_START_HEIGHT,this.ball.x=(this.whoWon==="P2"?3:1)*this.width/4-this.ball.radius,this.ball.y=this.height-Constants.BALL_START_HEIGHT,this.ball.velocity.x=this.ball.velocity.y=this.p1.velocity.x=this.p1.velocity.y=this.p2.velocity.x=this.p2.velocity.y=0,this.ball.falling=!1,this.p1.falling=this.p2.falling=!1,this.p1.gravTime=this.ball.gravTime=this.p2.gravTime=0,this.p1.jumpSpeed=this.p2.jumpSpeed=0,this.p1.score>=Constants.WIN_SCORE||this.p2.score>=Constants.WIN_SCORE?(this.displayMsg+="\nPress any key to continue.",this.ball.x=this.width/4-this.ball.radius):(this.restartPause=-1,this.ball.velocity.y=2,this.ball.falling=!0,this.displayMsg=null);if(this.restartPause>60&&(this.p1.score>=Constants.WIN_SCORE||this.p2.score>=Constants.WIN_SCORE)&&Globals.Input.anyInput)return this.displayMsg=null,this.restartPause=-1,this.p1.score=this.p2.score=0,this.ball.velocity.y=2,this.ball.falling=!0,this.whoWon="NONE",this.ulTime=0},a.prototype.draw=function(){var a,b,c,d,e;this.ctx.clearRect(0,0,this.width,this.height),e=this.sprites;for(c=0,d=e.length;c<d;c++)b=e[c],b.draw(this.ctx);if(this.displayMsg){this.ctx.font="bold 14px "+Constants.MSG_FONT,this.ctx.fillStyle="#ffffff",this.ctx.textAlign="center",a=this.displayMsg.split("\n"),this.ctx.fillText(a[0],this.width/2,85);if(a.length>1)return this.ctx.font="bold 11px "+Constants.MSG_FONT,this.ctx.fillText(a[1],this.width/2,110)}},a.prototype.step=function(a){return this.next(),this.freezeGame?this.draw():(this.ball.y+this.ball.height>=this.height-Constants.BOTTOM&&this.restartPause<0&&(this.restartPause=this.world.restartPause=0,this.ball.y=this.height-Constants.BOTTOM-this.ball.height,this.ball.velocity={x:0,y:0},this.ball.falling=!1,this.whoWon=this.ball.x+this.ball.radius<this.width/2?"P2":"P1",this.whoWon==="P1"?(this.p1.score++,this.p1.score<Constants.WIN_SCORE?this.displayMsg=this.winMsgs[Helpers.rand(this.winMsgs.length-2)]:this.displayMsg=this.winMsgs[this.winMsgs.length-1]):(this.p2.score++,this.p2.score<Constants.WIN_SCORE?this.displayMsg=this.failMsgs[Helpers.rand(this.failMsgs.length-2)]:this.displayMsg=this.failMsgs[this.failMsgs.length-1])),this.world.step(),this.restartPause>-1&&this.handlePause(),this.restartPause<0&&(this.moveCPU(),this.p1.handleInput(Globals.Input)),this.world.boundsCheck(),this.draw())},a.prototype.buttonPressed=function(a){return Globals.Manager.popScene()},a}();var NetworkSlimeVolleyball,s,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};window.io||(s=document.createElement("script"),s.setAttribute("src","/socket.io/socket.io.js"),document.head.appendChild(s)),NetworkSlimeVolleyball=function(){function a(){a.__super__.constructor.apply(this,arguments)}return __extends(a,SlimeVolleyball),a.prototype.init=function(){var b=this;return a.__super__.init.call(this),this.freezeGame=!0,this.displayMsg="Loading...",this.frame=null,this.frameSent=0,this.socket&&this.socket.disconnect()&&(this.socket=null),this.socket=io.connect(),this.socket.on("connect",function(){return b.displayMsg="Connected. Waiting for opponent..."}),this.socket.on("gameInit",function(){return b.displayMsg="Opponent found! Game begins in 1 second..."}),this.socket.on("gameStart",function(){return b.freezeGame=!1,b.displayMsg=null})
,this.socket.on("gameFrame",function(a){return b.frame=a}),this.socket.on("gameEnd",function(a){return b.freezeGame=!0}),this.socket.on("opponentLost",function(){return b.freezeGame=!0,b.displayMsg="Lost connection to opponent. Looking for new match..."}),window.socket=this.socket,this.first=!0},a.prototype.moveCPU=function(){},a.prototype.applyFrameData=function(a,b){var c,d,e,f,g,h,i,j,k;this.first=!1,e=Math.atan(a.velocity.y/a.velocity.x),h=Math.atan(b.velocity.y/b.velocity.x);if(!(Math.abs(e-h)<45)){k=[];for(g in a){if(!__hasProp.call(a,g))continue;i=a[g],k.push(b[g]=i)}return k}d=Helpers.dist(a,b),f=d/Helpers.velocityMag(b),console.log("framesBehind = "+f);if(f>Constants.FRAME_DROP_THRESHOLD){for(g in a){if(!__hasProp.call(a,g))continue;i=a[g],b[g]=i}return}c=Math.atan((b.y-a.y)/(b.x-a.x));if(Math.abs(c-e)>22){j=[];for(g in a){if(!__hasProp.call(a,g))continue;i=a[g],j.push(b[g]=i)}return j}},a.prototype.applyFrame=function(a){var b,c,d;d=[];for(b in a){if(!__hasProp.call(a,b))continue;c=a[b],d.push(this.applyFrameData(c,this[b]))}return d},a.prototype.step=function(a){var b;return this.frame&&(b=this.frame,this.frame=null,console.log("received frame! applying..."),this.applyFrame(b)),this.next(),this.freezeGame?this.draw():(this.world.step(),this.restartPause>-1&&this.handlePause(),this.restartPause<0&&(this.moveCPU(),this.p1.handleInput(Globals.Input)),this.world.boundsCheck(),this.draw())},a.prototype.destroy=function(){return this.socket.disconnect()},a}();var InstructionsScene,__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};InstructionsScene=function(){function a(){var b;a.__super__.constructor.call(this),this.bg=new StretchySprite(0,0,this.width,this.height,1,1,Globals.Loader.getAsset("instructions")),b=Globals.Loader.getAsset("back_arrow"),this.buttons={back:new Button(10,10,50,50,b,b,this)}}return __extends(a,Scene),a.prototype.step=function(a){var b,c,d,e;if(!this.ctx)return;this.next(),this.ctx.clearRect(0,0,this.width,this.height),this.bg.draw(this.ctx),d=this.buttons,e=[];for(c in d)b=d[c],e.push(b.draw(this.ctx));return e},a.prototype.buttonPressed=function(a){return Globals.Manager.popScene()},a}(),window.onload=function(){var a;return Globals.Manager.canvas=document.getElementById("canvas"),Globals.Manager.ctx=Globals.Manager.canvas.getContext("2d"),Globals.Input=new Input,a=new LoadingScene,Globals.Manager.pushScene(a),a.start()}